% =============================================================================
% CAPITULO 3: ESTADO DEL ARTE
% =============================================================================

\chapter{Estado del Arte}
\label{ch:estado_arte}

Este capitulo presenta una revision de la literatura relacionada con la deteccion de landmarks en imagenes medicas, comparando diferentes enfoques metodologicos e identificando las brechas de investigacion que este trabajo busca abordar.

% -----------------------------------------------------------------------------
\section{Deteccion de Landmarks en Imagenes Medicas}
\label{sec:landmarks_medicos}
% -----------------------------------------------------------------------------

La deteccion automatica de landmarks anatomicos tiene una larga historia en el procesamiento de imagenes medicas, evolucionando desde metodos basados en caracteristicas handcrafted hasta las aproximaciones actuales basadas en deep learning.

\subsection{Metodos Tradicionales}

Los enfoques clasicos para deteccion de landmarks incluyen:

\begin{itemize}
    \item \textbf{Active Shape Models (ASM)} \cite{cootes1995active}: Modelan la variabilidad de forma mediante analisis de componentes principales (PCA) y ajustan iterativamente el modelo a nuevas imagenes.

    \item \textbf{Active Appearance Models (AAM)} \cite{cootes2001active}: Extienden ASM incorporando informacion de textura ademas de forma.

    \item \textbf{Random Forests con caracteristicas de contexto} \cite{lindner2015fully}: Utilizan arboles de decision entrenados con patches locales para regresion de posicion.

    \item \textbf{Cascaded Pose Regression} \cite{dollar2010cascaded}: Refinamiento iterativo de predicciones mediante cascadas de regresores.
\end{itemize}

Estos metodos han sido ampliamente utilizados en analisis cefalometrico de radiografias dentales \cite{wang2016benchmark}, logrando errores del orden de 2-3 mm en resoluciones clinicas.

\subsection{Deep Learning para Landmarks Medicos}

La transicion a deep learning ha permitido mejoras significativas en precision y robustez:

\begin{table}[htbp]
    \centering
    \caption{Comparacion de metodos de deep learning para deteccion de landmarks medicos}
    \label{tab:dl_landmarks}
    \begin{tabular}{@{}llccc@{}}
        \toprule
        \textbf{Metodo} & \textbf{Modalidad} & \textbf{Landmarks} & \textbf{Error} & \textbf{Referencia} \\
        \midrule
        CNN + Heatmap & Cefalometrico & 19 & 1.17 mm & \cite{zhong2019attention} \\
        U-Net & Columna vertebral & 17 & 2.3 px & \cite{chen2019vertebrae} \\
        HRNet & Facial & 68 & 1.2 px & \cite{wang2020deep} \\
        SCN & Cefalometrico & 19 & 1.21 mm & \cite{payer2019integrating} \\
        \bottomrule
    \end{tabular}
\end{table}

% -----------------------------------------------------------------------------
\section{Enfoques: Heatmaps vs Regresion Directa}
\label{sec:heatmaps_vs_regresion}
% -----------------------------------------------------------------------------

Existen dos paradigmas principales para la prediccion de coordenadas de landmarks:

\subsection{Regresion Basada en Heatmaps}

En este enfoque, la red produce un mapa de calor gaussiano por cada landmark, donde el pico indica la ubicacion predicha:

\begin{equation}
    H_i(x, y) = \exp\left(-\frac{(x - x_i^*)^2 + (y - y_i^*)^2}{2\sigma^2}\right)
    \label{eq:heatmap}
\end{equation}

donde $(x_i^*, y_i^*)$ es la ubicacion del landmark $i$ y $\sigma$ controla el ancho de la gaussiana.

\textbf{Ventajas}:
\begin{itemize}
    \item Supervision densa: cada pixel recibe senal de entrenamiento
    \item Representacion espacialmente explicita
    \item Facilita el aprendizaje de relaciones espaciales
    \item Permite precision subpixel mediante soft-argmax
\end{itemize}

\textbf{Desventajas}:
\begin{itemize}
    \item Mayor costo computacional (decodificador requerido)
    \item Resolucion limitada por el tamano del heatmap
    \item Requiere postprocesamiento para extraer coordenadas
\end{itemize}

\textbf{Arquitecturas representativas}:
\begin{itemize}
    \item \textbf{Stacked Hourglass} \cite{newell2016stacked}: Arquitectura encoder-decoder repetida para refinamiento progresivo.
    \item \textbf{HRNet} \cite{sun2019deep}: Mantiene representaciones de alta resolucion a lo largo de la red.
    \item \textbf{SimpleBaseline} \cite{xiao2018simple}: ResNet + upsampling, demuestra que la simplicidad puede ser efectiva.
\end{itemize}

\subsection{Regresion Directa de Coordenadas}

Este enfoque predice directamente las coordenadas $(x, y)$ de cada landmark mediante capas fully connected:

\begin{equation}
    \hat{\vec{y}} = f_{\theta}(\vec{x}) \in \R^{2K}
    \label{eq:direct_regression}
\end{equation}

donde $K$ es el numero de landmarks.

\textbf{Ventajas}:
\begin{itemize}
    \item Arquitectura mas simple y ligera
    \item Inferencia mas rapida
    \item No requiere postprocesamiento
    \item Mejor manejo de landmarks fuera del campo de vision
\end{itemize}

\textbf{Desventajas}:
\begin{itemize}
    \item Supervision escasa (solo 2K valores por imagen)
    \item Puede tener dificultad con relaciones espaciales complejas
    \item Sensible a la inicializacion
\end{itemize}

\subsection{Justificacion de la Eleccion}

En este trabajo se opto por \textbf{regresion directa} debido a:

\begin{enumerate}
    \item \textbf{Tamano del dataset}: Con solo 957 imagenes, la regresion directa aprovecha mejor la supervision disponible.
    \item \textbf{Numero de landmarks}: Con 15 landmarks, la dimension de salida (30) es manejable.
    \item \textbf{Eficiencia}: Menor costo computacional para entrenamiento y despliegue.
    \item \textbf{Evidencia empirica}: Trabajos recientes \cite{feng2018wing} muestran que la regresion directa con funciones de perdida adecuadas alcanza rendimiento competitivo.
\end{enumerate}

% -----------------------------------------------------------------------------
\section{Deteccion de Landmarks en Radiografias de Torax}
\label{sec:landmarks_torax}
% -----------------------------------------------------------------------------

La deteccion de landmarks especificamente en radiografias toracicas ha recibido menos atencion que otras modalidades como radiografias cefalometricas o imagenes faciales.

\subsection{Trabajos Relacionados}

\textbf{Jaeger et al. (2014)} \cite{jaeger2014automatic} desarrollaron un sistema para segmentacion de campos pulmonares utilizando Active Shape Models, logrando precisiones del 95\% en la segmentacion pero sin reportar errores de localizacion de landmarks especificos.

\textbf{Candemir et al. (2014)} \cite{candemir2014lung} propusieron un metodo basado en atlas para segmentacion pulmonar, identificando contornos pero no puntos anatomicos discretos.

\textbf{Rajpurkar et al. (2017)} \cite{rajpurkar2017chexnet} desarrollaron CheXNet para deteccion de patologias, demostrando que redes profundas pueden superar a radiologos en tareas especificas, aunque no abordaron la localizacion de landmarks.

\textbf{Wang et al. (2020)} \cite{wang2020covid} crearon COVID-Net para clasificacion de COVID-19 en radiografias, evidenciando el interes creciente en analisis automatizado de radiografias toracicas durante la pandemia.

\subsection{Gaps Identificados}

La revision de literatura revela varias brechas de investigacion:

\begin{enumerate}
    \item \textbf{Escasez de benchmarks}: A diferencia del dominio cefalometrico (con datasets estandar como el del ISBI Challenge), no existen benchmarks publicos establecidos para landmarks en radiografias toracicas.

    \item \textbf{Foco en clasificacion}: La mayoria de trabajos recientes se enfocan en clasificacion de patologias, no en localizacion de estructuras anatomicas.

    \item \textbf{Evaluacion limitada en patologia}: Los pocos trabajos existentes tipicamente evaluan solo en imagenes normales, sin considerar el impacto de condiciones patologicas.

    \item \textbf{Falta de analisis por landmark}: Los reportes agregados (error medio global) ocultan variabilidad significativa entre landmarks de diferente dificultad.
\end{enumerate}

% -----------------------------------------------------------------------------
\section{Funciones de Perdida Especializadas}
\label{sec:loss_estado_arte}
% -----------------------------------------------------------------------------

\subsection{Evolucion de Loss Functions para Landmarks}

La eleccion de la funcion de perdida ha demostrado ser critica para el rendimiento:

\begin{table}[htbp]
    \centering
    \caption{Evolucion de funciones de perdida para deteccion de landmarks}
    \label{tab:loss_evolution}
    \begin{tabular}{@{}lp{5cm}l@{}}
        \toprule
        \textbf{Loss} & \textbf{Caracteristica} & \textbf{Referencia} \\
        \midrule
        MSE/L2 & Basico, sensible a outliers & - \\
        Smooth L1 & Robustez ante outliers & \cite{girshick2015fast} \\
        Wing Loss & Mayor sensibilidad a errores pequenos & \cite{feng2018wing} \\
        Adaptive Wing & Parametros adaptativos por landmark & \cite{wang2019adaptive} \\
        DSNT & Gradientes suaves para heatmaps & \cite{nibali2018numerical} \\
        \bottomrule
    \end{tabular}
\end{table}

\subsection{Wing Loss en la Literatura}

\textbf{Feng et al. (2018)} \cite{feng2018wing} demostraron que Wing Loss supera a MSE y Smooth L1 en deteccion de landmarks faciales, con mejoras del 10-15\% en datasets estandar como AFLW y COFW.

\textbf{Wu et al. (2018)} \cite{wu2018look} combinaron Wing Loss con mecanismos de atencion para deteccion de landmarks faciales, logrando resultados estado del arte en 300-W.

El exito de Wing Loss se atribuye a su comportamiento diferenciado:
\begin{itemize}
    \item Gradientes mayores para errores pequenos (mejor precision fina)
    \item Gradientes acotados para errores grandes (robustez ante outliers)
\end{itemize}

% -----------------------------------------------------------------------------
\section{Mecanismos de Atencion en Vision por Computadora}
\label{sec:atencion_estado_arte}
% -----------------------------------------------------------------------------

Los mecanismos de atencion han revolucionado el procesamiento de imagenes:

\subsection{Atencion de Canal}

\textbf{Squeeze-and-Excitation Networks (SE-Net)} \cite{hu2018squeeze} introducen recalibracion de canales mediante:

\begin{equation}
    \vec{s} = \sigma(\mat{W}_2 \delta(\mat{W}_1 \text{GAP}(\vec{F})))
    \label{eq:se_net}
\end{equation}

donde GAP es Global Average Pooling. Los pesos $\vec{s}$ reescalan los canales segun su importancia.

\subsection{Atencion Espacial}

\textbf{CBAM} \cite{woo2018cbam} combina atencion de canal y espacial secuencialmente, aplicando pooling espacial para generar mapas de atencion 2D.

\subsection{Coordinate Attention}

\textbf{Hou et al. (2021)} \cite{hou2021coordinate} propusieron Coordinate Attention, que:
\begin{itemize}
    \item Codifica informacion posicional en la atencion de canal
    \item Captura dependencias espaciales de largo alcance
    \item Mantiene precision posicional mediante descomposicion direccional
\end{itemize}

Este mecanismo es particularmente adecuado para tareas de localizacion precisa como deteccion de landmarks.

% -----------------------------------------------------------------------------
\section{Preprocesamiento para Imagenes Medicas}
\label{sec:preprocesamiento_estado_arte}
% -----------------------------------------------------------------------------

\subsection{Ecualizacion de Histograma}

El contraste en radiografias varia significativamente debido a diferencias en equipos y parametros de adquisicion. Las tecnicas de ecualizacion buscan normalizar esta variabilidad:

\begin{itemize}
    \item \textbf{Histogram Equalization (HE)}: Ecualizacion global, puede sobreamplificar ruido.
    \item \textbf{AHE (Adaptive)}: Ecualizacion local por regiones, mejor contraste pero puede introducir artefactos.
    \item \textbf{CLAHE}: Limita el contraste maximo, previniendo sobreamplificacion.
\end{itemize}

\textbf{Pizer et al. (1987)} \cite{pizer1987adaptive} introdujeron CLAHE, demostrando mejoras significativas en la visualizacion de estructuras anatomicas.

\textbf{Reza (2004)} \cite{reza2004realization} analizo el impacto del clip limit en diferentes modalidades, recomendando valores entre 2.0 y 4.0 para radiografias.

\subsection{CLAHE para COVID-19}

Estudios recientes han explorado CLAHE especificamente para imagenes de COVID-19:

\textbf{Horry et al. (2020)} \cite{horry2020covid} encontraron que CLAHE mejora la deteccion de consolidaciones pulmonares en redes de clasificacion.

\textbf{Abbas et al. (2021)} \cite{abbas2021classification} reportaron mejoras del 5-10\% en clasificacion de COVID-19 al aplicar CLAHE como preprocesamiento.

Sin embargo, \textbf{ninguno de estos trabajos evaluo el impacto de CLAHE en tareas de localizacion de landmarks}, lo cual representa una contribucion de esta tesis.

% -----------------------------------------------------------------------------
\section{Ensemble Learning en Deep Learning}
\label{sec:ensemble_estado_arte}
% -----------------------------------------------------------------------------

\subsection{Fundamentos}

El ensemble de modelos es una tecnica establecida para mejorar rendimiento:

\textbf{Dietterich (2000)} \cite{dietterich2000ensemble} formaliz√≥ las tres razones por las que los ensembles funcionan:
\begin{enumerate}
    \item \textbf{Estadistica}: Promediar reduce varianza cuando los datos son limitados
    \item \textbf{Computacional}: Diferentes optimos locales pueden promediarse
    \item \textbf{Representacional}: El espacio de hipotesis efectivo se expande
\end{enumerate}

\subsection{Estrategias de Diversificacion}

Para que un ensemble sea efectivo, los modelos deben ser diversos:

\begin{itemize}
    \item \textbf{Diferentes seeds}: Inicializacion aleatoria diferente
    \item \textbf{Diferentes arquitecturas}: Combinacion de modelos heterogeneos
    \item \textbf{Diferentes subconjuntos de datos}: Bagging
    \item \textbf{Diferentes hiperparametros}: Grid search con seleccion de top-K
\end{itemize}

\subsection{Ensembles en Deteccion de Landmarks}

\textbf{Sun et al. (2015)} \cite{sun2015deep} demostraron que ensembles de CNNs mejoran 10-15\% sobre modelos individuales en deteccion de landmarks faciales.

\textbf{Kowalski et al. (2017)} \cite{kowalski2017deep} encontraron que la diversidad en inicializacion es mas importante que la diversidad arquitectonica para tareas de regresion.

% -----------------------------------------------------------------------------
\section{Test-Time Augmentation}
\label{sec:tta_estado_arte}
% -----------------------------------------------------------------------------

\TTA ha demostrado ser efectivo en multiples dominios:

\textbf{Krizhevsky et al. (2012)} \cite{krizhevsky2012imagenet} utilizaron TTA (10 crops + flip) en ImageNet, mejorando precision en 1-2\%.

\textbf{Szegedy et al. (2015)} \cite{szegedy2015going} sistematizaron el uso de TTA para clasificacion.

\textbf{Moshkov et al. (2020)} \cite{moshkov2020test} analizaron TTA especificamente para segmentacion medica, encontrando mejoras consistentes del 1-3\%.

Para \textbf{regresion de coordenadas}, TTA requiere consideraciones especiales:
\begin{itemize}
    \item Las transformaciones geometricas deben invertirse en las predicciones
    \item Para flip horizontal, los landmarks simetricos deben intercambiarse
    \item Rotaciones requieren transformacion inversa de coordenadas
\end{itemize}

% -----------------------------------------------------------------------------
\section{Datasets de Referencia}
\label{sec:datasets}
% -----------------------------------------------------------------------------

\begin{table}[htbp]
    \centering
    \caption{Datasets relevantes para deteccion de landmarks medicos}
    \label{tab:datasets}
    \begin{tabular}{@{}llccc@{}}
        \toprule
        \textbf{Dataset} & \textbf{Modalidad} & \textbf{Imagenes} & \textbf{Landmarks} & \textbf{Publico} \\
        \midrule
        ISBI 2015 & Cefalometrico & 400 & 19 & Si \\
        300-W & Facial & 3,148 & 68 & Si \\
        AFLW & Facial & 25,993 & 21 & Si \\
        ChestX-ray14 & Torax & 112,120 & 0* & Si \\
        COVID-CT & Torax & 349 & 0* & Si \\
        \textbf{Este trabajo} & \textbf{Torax} & \textbf{957} & \textbf{15} & \textbf{No**} \\
        \bottomrule
    \end{tabular}
    \begin{tablenotes}
        \small
        \item * Datasets sin anotaciones de landmarks (solo etiquetas de patologia)
        \item ** Dataset propietario utilizado en este trabajo
    \end{tablenotes}
\end{table}

La falta de datasets publicos con anotaciones de landmarks en radiografias toracicas representa una barrera significativa para la investigacion en esta area.

% -----------------------------------------------------------------------------
\section{Sintesis y Posicionamiento}
\label{sec:sintesis}
% -----------------------------------------------------------------------------

\subsection{Resumen del Estado del Arte}

La \cref{tab:estado_arte_resumen} sintetiza las principales tecnicas y sus caracteristicas:

\begin{table}[htbp]
    \centering
    \caption{Resumen de tecnicas del estado del arte}
    \label{tab:estado_arte_resumen}
    \begin{tabular}{@{}p{3cm}p{4cm}p{4cm}@{}}
        \toprule
        \textbf{Componente} & \textbf{Estado del Arte} & \textbf{Este Trabajo} \\
        \midrule
        Backbone & ResNet, HRNet, EfficientNet & ResNet-18 \\
        Enfoque & Heatmaps, DSNT & Regresion directa \\
        Atencion & SE-Net, CBAM & Coordinate Attention \\
        Loss & Wing, AWL & Wing Loss \\
        Preprocesamiento & CLAHE (clasificacion) & CLAHE (localizacion) \\
        Ensemble & Heterogeneo, bagging & Homogeneo, multi-seed \\
        TTA & Clasificacion, segmentacion & Regresion de landmarks \\
        \bottomrule
    \end{tabular}
\end{table}

\subsection{Contribuciones Respecto al Estado del Arte}

Este trabajo contribuye al estado del arte en los siguientes aspectos:

\begin{enumerate}
    \item \textbf{Primera evaluacion sistematica de CLAHE para localizacion de landmarks en radiografias toracicas}, demostrando su efectividad particularmente para casos de COVID-19.

    \item \textbf{Analisis detallado por landmark y categoria}, proporcionando insights sobre la dificultad relativa de diferentes puntos anatomicos.

    \item \textbf{Demostracion de la efectividad del ensemble selectivo}, mostrando que excluir modelos de bajo rendimiento es mas efectivo que esquemas de ponderacion.

    \item \textbf{Validacion de regresion directa con Wing Loss} como alternativa viable a heatmaps para datasets pequenos.

    \item \textbf{Documentacion exhaustiva del proceso de desarrollo}, facilitando reproducibilidad y extension del trabajo.
\end{enumerate}

% -----------------------------------------------------------------------------
% FIN DEL CAPITULO
% -----------------------------------------------------------------------------
