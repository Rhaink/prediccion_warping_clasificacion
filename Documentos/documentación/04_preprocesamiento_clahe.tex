% ==============================================================================
% DOCUMENTACIÓN CIENTÍFICA - PREPROCESAMIENTO CLAHE Y DATA AUGMENTATION
% Proyecto: Detección de COVID-19 mediante Landmarks Anatómicos
% Sesiones cubiertas: 7-8
% ==============================================================================

\documentclass[12pt,a4paper]{article}
\input{00_preambulo}

\title{Preprocesamiento CLAHE y Data Augmentation para\\Detección de Landmarks en Radiografías}
\author{Documentación del Proceso de Desarrollo}
\date{Sesiones: 7-8}

\begin{document}
\maketitle

\begin{abstract}
Este documento detalla la implementación y optimización del preprocesamiento
mediante CLAHE (Contrast Limited Adaptive Histogram Equalization) y las
técnicas de data augmentation específicas para radiografías de tórax.
Se documenta el descubrimiento de que las consolidaciones pulmonares en
casos COVID-19 oscurecen los landmarks anatómicos, y cómo CLAHE resuelve
este problema reduciendo el error en imágenes COVID de 11.74 a 9.03 píxeles
(mejora del 23\%). También se presenta el manejo correcto del flip horizontal
para landmarks bilaterales mediante intercambio de índices de pares simétricos.
\end{abstract}

\tableofcontents
\newpage

% ==============================================================================
\section{Introducción y Motivación}
% ==============================================================================

El análisis de errores por categoría en la sesión 6 reveló un patrón crítico:
los casos de COVID-19 presentaban errores significativamente mayores que las
otras categorías, especialmente en landmarks de la zona inferior del tórax.

\begin{table}[htbp]
\centering
\caption{Error por zona anatómica y categoría (sesión 6)}
\label{tab:error_por_zona}
\begin{tabular}{llccc}
\toprule
\textbf{Zona} & \textbf{Landmarks} & \textbf{COVID (px)} & \textbf{Normal (px)} & \textbf{Diferencia} \\
\midrule
Ápice inferior & L2 & 16.2 & 9.6 & +6.6 \\
Costofrénicos & L14, L15 & 16.6 & 10.7 & +5.9 \\
Bases pulmonares & L7, L8 & 13.1 & 8.9 & +4.2 \\
Eje central & L9, L10, L11 & 10.8 & 7.2 & +3.6 \\
\bottomrule
\end{tabular}
\end{table}

\begin{hallazgo}[title={Causa médica del error elevado en COVID}]
COVID-19 causa consolidaciones pulmonares (opacidades en vidrio esmerilado y
consolidación alveolar) que se manifiestan como zonas blancas difusas en
radiografías. Estas consolidaciones se concentran principalmente en las
\textbf{bases pulmonares} y zonas \textbf{periféricas inferiores},
precisamente donde se ubican los landmarks con mayor error.
\end{hallazgo}

La hipótesis de trabajo fue que el realce de contraste local mediante CLAHE
podría hacer visibles los bordes anatómicos en zonas con consolidaciones.

% ==============================================================================
\section{Fundamentos Teóricos de CLAHE}
% ==============================================================================

\subsection{Ecualización de Histograma Adaptativa}

La ecualización de histograma tradicional redistribuye la intensidad de
píxeles para maximizar el contraste global. Sin embargo, en imágenes médicas
con variaciones locales de contraste (como consolidaciones pulmonares),
este enfoque puede sobre-amplificar el ruido y perder detalles locales.

\begin{definicion}[Histogram Equalization]
Dada una imagen $I$ con función de densidad de probabilidad $p(k)$ para
niveles de intensidad $k \in [0, L-1]$, la transformación de ecualización
es:
\begin{equation}
T(k) = \lfloor (L-1) \cdot \text{CDF}(k) \rfloor
\label{eq:hist_eq}
\end{equation}
donde $\text{CDF}(k) = \sum_{j=0}^{k} p(j)$ es la función de distribución
acumulativa.
\end{definicion}

\subsection{Adaptive Histogram Equalization (AHE)}

AHE divide la imagen en regiones (tiles) y aplica ecualización de histograma
independientemente a cada una:

\begin{equation}
I'(x, y) = T_{R(x,y)}(I(x, y))
\label{eq:ahe}
\end{equation}

donde $R(x,y)$ denota la región contextual (tile) que contiene el píxel
$(x, y)$ y $T_{R}$ es la transformación de ecualización local para esa región.

\subsection{Contrast Limited AHE (CLAHE)}

CLAHE introduce un límite de contraste (clip limit) para prevenir la
sobre-amplificación del ruido en regiones homogéneas.

\begin{definicion}[Clip Limit]
Sea $N_{pixels}$ el número de píxeles en un tile y $N_{bins}$ el número de
bins del histograma. El número máximo permitido de píxeles por bin es:
\begin{equation}
\beta_{max} = \frac{N_{pixels}}{N_{bins}} \cdot (1 + \alpha)
\label{eq:clip_limit}
\end{equation}
donde $\alpha$ es el parámetro de clip limit ($\alpha = 0$ corresponde a
histograma uniforme, $\alpha \to \infty$ a AHE sin limitación).
\end{definicion}

\begin{algorithm}[H]
\caption{CLAHE (Contrast Limited Adaptive Histogram Equalization)}
\label{alg:clahe}
\begin{algorithmic}[1]
\REQUIRE Imagen $I$, clip\_limit $\alpha$, tile\_size $(t_x, t_y)$
\ENSURE Imagen procesada $I'$
\STATE Dividir imagen en grid de tiles de tamaño $(t_x, t_y)$
\FORALL{tile $T_i$ en grid}
    \STATE Calcular histograma $h_i$ del tile
    \STATE $\beta_{max} \leftarrow (|T_i|/256) \cdot (1 + \alpha)$
    \STATE \COMMENT{Recortar y redistribuir exceso}
    \STATE $excess \leftarrow 0$
    \FORALL{bin $b$ en $h_i$}
        \IF{$h_i[b] > \beta_{max}$}
            \STATE $excess \leftarrow excess + (h_i[b] - \beta_{max})$
            \STATE $h_i[b] \leftarrow \beta_{max}$
        \ENDIF
    \ENDFOR
    \STATE Redistribuir $excess$ uniformemente entre todos los bins
    \STATE Calcular CDF de $h_i$ clipeado
\ENDFOR
\FORALL{píxel $(x, y)$ en $I$}
    \STATE Interpolar transformación de los 4 tiles vecinos
    \STATE $I'(x, y) \leftarrow$ transformación interpolada de $I(x, y)$
\ENDFOR
\RETURN $I'$
\end{algorithmic}
\end{algorithm}

\subsection{Aplicación en Espacio de Color LAB}

En lugar de aplicar CLAHE directamente a cada canal RGB (lo cual puede
introducir artefactos de color), se utiliza el espacio de color CIE LAB:

\begin{equation}
\begin{pmatrix} L^* \\ a^* \\ b^* \end{pmatrix} = f_{RGB \to LAB}
\begin{pmatrix} R \\ G \\ B \end{pmatrix}
\label{eq:rgb_to_lab}
\end{equation}

El canal $L^*$ (luminancia) contiene la información de intensidad, mientras
que $a^*$ y $b^*$ codifican la cromacidad. CLAHE se aplica únicamente al
canal $L^*$:

\begin{equation}
L'^* = \text{CLAHE}(L^*; \alpha, t)
\label{eq:clahe_luminance}
\end{equation}

\begin{equation}
I' = f_{LAB \to RGB}(L'^*, a^*, b^*)
\label{eq:lab_to_rgb}
\end{equation}

Esta estrategia preserva la información cromática original mientras mejora
el contraste de luminancia.

% ==============================================================================
\section{Implementación}
% ==============================================================================

\subsection{Función CLAHE en OpenCV}

La implementación utiliza la función \texttt{cv2.createCLAHE} de OpenCV:

\begin{lstlisting}[language=Python, caption={Implementación de CLAHE en espacio LAB}]
def apply_clahe(
    image: Image.Image,
    clip_limit: float = 2.0,
    tile_grid_size: Tuple[int, int] = (8, 8)
) -> Image.Image:
    """
    Aplica CLAHE al canal de luminancia en espacio LAB.
    """
    img_array = np.array(image)

    # RGB -> LAB
    lab = cv2.cvtColor(img_array, cv2.COLOR_RGB2LAB)
    l_channel, a_channel, b_channel = cv2.split(lab)

    # Aplicar CLAHE solo al canal L (luminancia)
    clahe = cv2.createCLAHE(
        clipLimit=clip_limit,
        tileGridSize=tile_grid_size
    )
    l_clahe = clahe.apply(l_channel)

    # Recombinar y convertir LAB -> RGB
    lab_clahe = cv2.merge([l_clahe, a_channel, b_channel])
    result = cv2.cvtColor(lab_clahe, cv2.COLOR_LAB2RGB)

    return Image.fromarray(result)
\end{lstlisting}

\subsection{Parámetros Configurables}

\begin{table}[htbp]
\centering
\caption{Parámetros CLAHE y valores por defecto}
\label{tab:clahe_params}
\begin{tabular}{llll}
\toprule
\textbf{Parámetro} & \textbf{Símbolo} & \textbf{Rango} & \textbf{Default} \\
\midrule
clip\_limit & $\alpha$ & $[0, \infty)$ & 2.0 \\
tile\_size & $t$ & $\{2, 4, 8, 16, ...\}$ & 8 \\
\bottomrule
\end{tabular}
\end{table}

% ==============================================================================
\section{Experimentación y Optimización}
% ==============================================================================

\subsection{Sesión 7: Evaluación Inicial de CLAHE}

Se comparó el rendimiento con y sin CLAHE usando los parámetros por defecto
de OpenCV ($\alpha = 2.0$, $t = 8$):

\begin{table}[htbp]
\centering
\caption{Comparación baseline vs CLAHE (sesión 7)}
\label{tab:clahe_vs_baseline}
\begin{tabular}{lcccc}
\toprule
\textbf{Configuración} & \textbf{Overall} & \textbf{COVID} & \textbf{Normal} & \textbf{Viral} \\
\midrule
Baseline (sin CLAHE) & 8.93 px & 11.74 px & 7.79 px & 8.01 px \\
\textbf{CLAHE ($\alpha$=2.0, $t$=8)} & \textbf{8.18 px} & \textbf{9.47 px} & \textbf{7.09 px} & 8.78 px \\
\midrule
$\Delta$ & -0.75 px & \textbf{-2.27 px} & -0.70 px & +0.77 px \\
$\Delta$\% & -8.4\% & \textbf{-19.3\%} & -9.0\% & +9.6\% \\
\bottomrule
\end{tabular}
\end{table}

\begin{resultadoimportante}[title={Efectividad de CLAHE para COVID}]
CLAHE redujo el error en imágenes COVID de 11.74 a 9.47 píxeles, una mejora
del \textbf{19.3\%}. Esto confirma la hipótesis de que las consolidaciones
pulmonares oscurecen los landmarks y que el realce de contraste local
los hace visibles nuevamente.
\end{resultadoimportante}

\subsection{Experimento Fallido: Category Weights}

Se intentó combinar CLAHE con sobremuestreo de categorías difíciles mediante
\texttt{WeightedRandomSampler}:

\begin{table}[htbp]
\centering
\caption{CLAHE + Category Weights (experimento fallido)}
\label{tab:category_weights}
\begin{tabular}{lccc}
\toprule
\textbf{Configuración} & \textbf{COVID} & \textbf{Normal} & \textbf{Overall} \\
\midrule
CLAHE solo & 9.47 px & 7.09 px & 8.18 px \\
CLAHE + Weights (COVID=2.0) & 10.37 px & 6.83 px & 8.31 px \\
\bottomrule
\end{tabular}
\end{table}

El sobremuestreo de COVID causó overfitting: aunque Normal mejoró, COVID
empeoró de 9.47 a 10.37 px. Se descartó esta técnica.

\subsection{Sesión 8: Optimización de Hiperparámetros}

Se realizó un barrido sistemático de los parámetros CLAHE:

\begin{table}[htbp]
\centering
\caption{Optimización de parámetros CLAHE (sesión 8)}
\label{tab:clahe_optimization}
\begin{tabular}{cccc}
\toprule
\textbf{clip\_limit} & \textbf{tile\_size} & \textbf{Error Test} & \textbf{vs Baseline} \\
\midrule
1.5 & 8 & 8.12 px & -0.06 px \\
2.0 & 8 & 8.18 px & baseline \\
3.0 & 8 & 8.23 px & +0.05 px \\
2.0 & 16 & 8.82 px & +0.64 px \\
\textbf{2.0} & \textbf{4} & \textbf{7.84 px} & \textbf{-0.34 px} \\
\bottomrule
\end{tabular}
\end{table}

\begin{hallazgo}[title={tile\_size óptimo es 4}]
Contra la intuición inicial, tiles más pequeños (4×4) producen mejores
resultados que el valor por defecto (8×8). Esto se debe a que CLAHE con
tiles más granulares realza mejor los \textbf{bordes locales} en zonas
pequeñas con consolidaciones pulmonares, donde la variación de contraste
es muy localizada.
\end{hallazgo}

\subsection{Configuración Final CLAHE}

\begin{table}[htbp]
\centering
\caption{Parámetros CLAHE optimizados}
\label{tab:clahe_final}
\begin{tabular}{lll}
\toprule
\textbf{Parámetro} & \textbf{Valor} & \textbf{Justificación} \\
\midrule
clip\_limit & 2.0 & Balance entre contraste y ruido \\
tile\_size & 4 & Realce granular de bordes locales \\
Espacio de color & LAB & Preserva información cromática \\
\bottomrule
\end{tabular}
\end{table}

\begin{table}[htbp]
\centering
\caption{Resultados finales con CLAHE optimizado}
\label{tab:clahe_final_results}
\begin{tabular}{lcc}
\toprule
\textbf{Categoría} & \textbf{Error (px)} & \textbf{Mejora vs Sesión 6} \\
\midrule
Normal & 7.00 & -10.1\% \\
Viral & 7.98 & -0.4\% \\
COVID & 9.03 & \textbf{-23.1\%} \\
\midrule
\textbf{Overall} & \textbf{7.84} & \textbf{-12.2\%} \\
\bottomrule
\end{tabular}
\end{table}

% ==============================================================================
\section{Data Augmentation para Landmarks}
% ==============================================================================

\subsection{Transformaciones Aplicadas}

El pipeline de augmentation incluye tres tipos de transformaciones, cada
una requiriendo manejo específico de las coordenadas de landmarks:

\begin{table}[htbp]
\centering
\caption{Transformaciones de data augmentation}
\label{tab:augmentations}
\begin{tabular}{llll}
\toprule
\textbf{Transformación} & \textbf{Parámetros} & \textbf{Probabilidad} & \textbf{Ajuste coords} \\
\midrule
Flip horizontal & - & 0.5 & Sí (complejo) \\
Rotación & $\pm 10°$ & 1.0 & Sí (matriz 2D) \\
Brillo & $[0.8, 1.2]$ & 1.0 & No \\
Contraste & $[0.8, 1.2]$ & 1.0 & No \\
\bottomrule
\end{tabular}
\end{table}

\subsection{Flip Horizontal: Manejo de Pares Simétricos}

El flip horizontal en landmarks es más complejo que el flip de imagen
estándar porque requiere \textbf{intercambiar los índices} de landmarks
bilaterales, no solo reflejar las coordenadas.

\begin{definicion}[Pares Simétricos]
Los pares de landmarks $(L_i, L_j)$ que son anatómicamente simétricos
respecto al eje central del cuerpo son:
\begin{equation}
\mathcal{S} = \{(L_3, L_4), (L_5, L_6), (L_7, L_8), (L_{12}, L_{13}), (L_{14}, L_{15})\}
\label{eq:symmetric_pairs}
\end{equation}
En notación de índices 0-based:
\begin{equation}
\mathcal{S}_{0} = \{(2, 3), (4, 5), (6, 7), (11, 12), (13, 14)\}
\label{eq:symmetric_pairs_0}
\end{equation}
\end{definicion}

\begin{algorithm}[H]
\caption{Flip Horizontal para Landmarks Bilaterales}
\label{alg:flip_horizontal}
\begin{algorithmic}[1]
\REQUIRE Imagen $I$, landmarks $\vect{L} \in \R^{15 \times 2}$ (coords normalizadas)
\ENSURE Imagen y landmarks transformados $(I', \vect{L}')$
\STATE $I' \leftarrow$ \texttt{flip\_horizontal}($I$)
\STATE $\vect{L}' \leftarrow$ copia de $\vect{L}$
\STATE \COMMENT{Paso 1: Reflejar coordenada X}
\FOR{$i = 0, 1, ..., 14$}
    \STATE $L'_i[x] \leftarrow 1.0 - L_i[x]$
\ENDFOR
\STATE \COMMENT{Paso 2: Intercambiar índices de pares simétricos}
\FORALL{$(i_{left}, i_{right}) \in \mathcal{S}_{0}$}
    \STATE \texttt{swap}($L'_{i_{left}}$, $L'_{i_{right}}$)
\ENDFOR
\RETURN $(I', \vect{L}')$
\end{algorithmic}
\end{algorithm}

\begin{observacion}
Si solo se refleja la coordenada X sin intercambiar índices, el modelo
aprende asociaciones incorrectas. Por ejemplo, después de un flip sin
intercambio, $L_3$ (originalmente a la izquierda) estaría en la posición
derecha pero con la etiqueta ``izquierda'', confundiendo al modelo.
\end{observacion}

\subsection{Rotación}

La rotación de landmarks utiliza la matriz de rotación 2D estándar,
centrada en el punto medio de la imagen:

\begin{equation}
\begin{pmatrix} x' \\ y' \end{pmatrix} =
\begin{pmatrix} \cos\theta & -\sin\theta \\ \sin\theta & \cos\theta \end{pmatrix}
\begin{pmatrix} x - 0.5 \\ y - 0.5 \end{pmatrix} +
\begin{pmatrix} 0.5 \\ 0.5 \end{pmatrix}
\label{eq:rotation}
\end{equation}

donde $(x, y)$ son coordenadas normalizadas en $[0, 1]$, $\theta$ es el
ángulo de rotación (limitado a $\pm 10°$ para preservar realismo anatómico),
y $(0.5, 0.5)$ es el centro de la imagen.

\begin{lstlisting}[language=Python, caption={Rotación de imagen y landmarks}]
def rotate(self, image, landmarks, angle):
    # Rotar imagen
    image = TF.rotate(image, angle, fill=0)

    # Rotar landmarks (angulo negativo: coords inversas)
    landmarks = landmarks.copy()
    cx, cy = 0.5, 0.5
    angle_rad = np.radians(-angle)

    cos_a, sin_a = np.cos(angle_rad), np.sin(angle_rad)
    x = landmarks[:, 0] - cx
    y = landmarks[:, 1] - cy

    new_x = x * cos_a - y * sin_a + cx
    new_y = x * sin_a + y * cos_a + cy

    landmarks[:, 0] = np.clip(new_x, 0, 1)
    landmarks[:, 1] = np.clip(new_y, 0, 1)

    return image, landmarks
\end{lstlisting}

\subsection{Color Jitter}

Las transformaciones de brillo y contraste no requieren ajuste de
coordenadas. Se aplican variaciones aleatorias dentro de rangos conservadores
para simular variaciones de exposición en radiografías:

\begin{equation}
I'(x, y) = \alpha_c \cdot (\alpha_b \cdot I(x, y)) + (1 - \alpha_c) \cdot \bar{I}
\label{eq:color_jitter}
\end{equation}

donde $\alpha_b \sim \mathcal{U}(0.8, 1.2)$ es el factor de brillo y
$\alpha_c \sim \mathcal{U}(0.8, 1.2)$ es el factor de contraste.

% ==============================================================================
\section{Pipeline Completo de Preprocesamiento}
% ==============================================================================

\subsection{Orden de Operaciones}

El orden de aplicación de las transformaciones es crítico:

\begin{enumerate}
    \item \textbf{CLAHE}: Aplicar en resolución original (mejor calidad)
    \item \textbf{Resize}: Redimensionar a $224 \times 224$
    \item \textbf{Flip horizontal}: Con intercambio de pares simétricos
    \item \textbf{Rotación}: $\pm 10°$ alrededor del centro
    \item \textbf{Color jitter}: Brillo y contraste
    \item \textbf{Normalización ImageNet}: $\mu = (0.485, 0.456, 0.406)$,
          $\sigma = (0.229, 0.224, 0.225)$
    \item \textbf{Conversión a tensor}: $[0, 255] \to [0, 1]$
\end{enumerate}

\begin{observacion}
CLAHE se aplica \textbf{antes} del resize para trabajar con la resolución
original de la imagen (299×299 píxeles), donde hay más información de
detalle para el realce de contraste.
\end{observacion}

\subsection{Diferencia Train vs Validation/Test}

\begin{table}[htbp]
\centering
\caption{Transformaciones por fase}
\label{tab:transforms_by_phase}
\begin{tabular}{lcc}
\toprule
\textbf{Transformación} & \textbf{Train} & \textbf{Val/Test} \\
\midrule
CLAHE & \checkmark & \checkmark \\
Resize & \checkmark & \checkmark \\
Flip horizontal & \checkmark (p=0.5) & $\times$ \\
Rotación & \checkmark ($\pm 10°$) & $\times$ \\
Color jitter & \checkmark & $\times$ \\
Normalización ImageNet & \checkmark & \checkmark \\
\bottomrule
\end{tabular}
\end{table}

% ==============================================================================
\section{Impacto en el Pipeline de Entrenamiento}
% ==============================================================================

\subsection{Comparación de Progreso}

\begin{table}[htbp]
\centering
\caption{Progreso del error con CLAHE (sesiones 6-8)}
\label{tab:progress_clahe}
\begin{tabular}{lcccc}
\toprule
\textbf{Sesión} & \textbf{Configuración} & \textbf{Overall} & \textbf{COVID} & \textbf{$\Delta$ COVID} \\
\midrule
6 & Sin CLAHE & 8.93 px & 11.74 px & baseline \\
7 & CLAHE ($t$=8) & 8.18 px & 9.47 px & -19.3\% \\
8 & CLAHE ($t$=4) & 7.84 px & 9.03 px & -23.1\% \\
\bottomrule
\end{tabular}
\end{table}

\subsection{Análisis por Landmark}

Los landmarks más beneficiados por CLAHE fueron aquellos en zonas
frecuentemente afectadas por consolidaciones:

\begin{itemize}
    \item \textbf{L14, L15} (ángulos costofrénicos): Mejora del 28\%
    \item \textbf{L7, L8} (bases pulmonares): Mejora del 22\%
    \item \textbf{L2} (ápice inferior): Mejora del 25\%
\end{itemize}

% ==============================================================================
\section{Figuras Sugeridas}
% ==============================================================================

\subsection{Figura 4.1: Comparación Visual CLAHE}
\textit{Descripción}: Grid 3×3 mostrando:
\begin{itemize}
    \item Fila 1: Imágenes originales (COVID, Normal, Viral)
    \item Fila 2: Imágenes con CLAHE ($t$=8)
    \item Fila 3: Imágenes con CLAHE ($t$=4) optimizado
\end{itemize}
Destacar zonas de consolidación donde se observa mejora de visibilidad.

\subsection{Figura 4.2: Efecto de tile\_size}
\textit{Descripción}: Comparación visual del mismo recorte de pulmón con
diferentes valores de tile\_size (2, 4, 8, 16), mostrando cómo tiles más
pequeños realzan bordes más locales.

\subsection{Figura 4.3: Pipeline de Preprocesamiento}
\textit{Descripción}: Diagrama de flujo mostrando:
\begin{enumerate}
    \item Imagen original 299×299
    \item CLAHE en espacio LAB
    \item Resize a 224×224
    \item Augmentation (train) / Sin augmentation (val/test)
    \item Normalización ImageNet
    \item Tensor de salida
\end{enumerate}

\subsection{Figura 4.4: Flip Horizontal con Intercambio}
\textit{Descripción}: Diagrama mostrando:
\begin{itemize}
    \item Imagen original con landmarks numerados
    \item Imagen flippeada con coordenadas reflejadas
    \item Resultado final con índices intercambiados
\end{itemize}
Enfatizar que sin intercambio, las etiquetas serían incorrectas.

\subsection{Figura 4.5: Error por Categoría con/sin CLAHE}
\textit{Descripción}: Gráfico de barras agrupadas comparando error por
categoría (COVID, Normal, Viral) con y sin CLAHE. Destacar la mejora
dramática en COVID.

% ==============================================================================
\section{Archivos Fuente}
% ==============================================================================

\begin{table}[htbp]
\centering
\caption{Archivos de implementación relevantes}
\label{tab:source_files}
\begin{tabular}{ll}
\toprule
\textbf{Archivo} & \textbf{Contenido} \\
\midrule
\archivo{src\_v2/data/transforms.py} & Implementación CLAHE y augmentations \\
\archivo{src\_v2/data/dataset.py} & LandmarkDataset con transforms \\
\archivo{scripts/train.py} & Flags --clahe, --clahe-clip, --clahe-tile \\
\bottomrule
\end{tabular}
\end{table}

% ==============================================================================
\section{Conclusiones}
% ==============================================================================

\begin{enumerate}
    \item \textbf{CLAHE es altamente efectivo para COVID-19}: Reduce el error
    en landmarks de imágenes con consolidaciones pulmonares en un 23\%.

    \item \textbf{Parámetros óptimos}: clip\_limit=2.0, tile\_size=4. Los
    tiles más pequeños son mejores para bordes locales.

    \item \textbf{Espacio LAB es preferible}: Aplicar CLAHE solo al canal de
    luminancia preserva la información cromática.

    \item \textbf{Data augmentation requiere manejo especial}: El flip
    horizontal debe intercambiar índices de pares simétricos, no solo
    reflejar coordenadas.

    \item \textbf{Order of operations importa}: CLAHE debe aplicarse antes
    del resize para aprovechar la resolución original.

    \item \textbf{Category weights no funcionan}: El sobremuestreo de
    categorías difíciles causa overfitting.
\end{enumerate}

\end{document}
